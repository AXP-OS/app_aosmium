From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: quh4gko8 <88831734+quh4gko8@users.noreply.github.com>
Date: Thu, 12 Dec 2024 07:09:40 +0000
Subject: [PATCH] Reduce user agent and client hints for webview

---
 android_webview/browser/aw_field_trials.cc           |  4 ----
 android_webview/common/aw_features.cc                |  2 +-
 .../chromium/WebViewChromiumFactoryProvider.java     | 12 ------------
 3 files changed, 1 insertion(+), 17 deletions(-)

diff --git a/android_webview/browser/aw_field_trials.cc b/android_webview/browser/aw_field_trials.cc
index ee925a45af212..4f8ae5a0c300f 100644
--- a/android_webview/browser/aw_field_trials.cc
+++ b/android_webview/browser/aw_field_trials.cc
@@ -85,10 +85,6 @@ void AwFieldTrials::RegisterFeatureOverrides(base::FeatureList* feature_list) {
   // Disable launch_handler on WebView.
   aw_feature_overrides.DisableFeature(::features::kAndroidWebAppLaunchHandler);
 
-  // Disable Reducing User Agent minor version on WebView.
-  aw_feature_overrides.DisableFeature(
-      blink::features::kReduceUserAgentMinorVersion);
-
   // Disable fenced frames on WebView.
   aw_feature_overrides.DisableFeature(blink::features::kFencedFrames);
 
diff --git a/android_webview/common/aw_features.cc b/android_webview/common/aw_features.cc
index a33c161a2ebca..54957335b2f5d 100644
--- a/android_webview/common/aw_features.cc
+++ b/android_webview/common/aw_features.cc
@@ -115,7 +115,7 @@ BASE_FEATURE(kWebViewUseInitialNetworkStateAtStartup,
 
 // This enables reducing webview user-agent android version and device model.
 BASE_FEATURE(kWebViewReduceUAAndroidVersionDeviceModel,
-             base::FEATURE_DISABLED_BY_DEFAULT);
+             base::FEATURE_ENABLED_BY_DEFAULT);
 
 // This enables WebView crashes.
 BASE_FEATURE(kWebViewEnableCrash, base::FEATURE_DISABLED_BY_DEFAULT);
diff --git a/android_webview/glue/java/src/com/android/webview/chromium/WebViewChromiumFactoryProvider.java b/android_webview/glue/java/src/com/android/webview/chromium/WebViewChromiumFactoryProvider.java
index e9cecc668cf99..338abef1ed6b1 100644
--- a/android_webview/glue/java/src/com/android/webview/chromium/WebViewChromiumFactoryProvider.java
+++ b/android_webview/glue/java/src/com/android/webview/chromium/WebViewChromiumFactoryProvider.java
@@ -687,18 +687,6 @@ public class WebViewChromiumFactoryProvider implements WebViewFactoryProvider {
             helper.applyFlagOverrides(
                     Map.of(AwFeatures.WEBVIEW_FILE_SYSTEM_ACCESS, shouldEnableFileSystemAccess()));
 
-            // Apply user-agent reduction overrides for WebView. These features
-            // are intended to be enabled only for Android B+.
-            // 1) ReduceUserAgentMinorVersion: Enables reduction of the user-agent minor version.
-            // 2) WebViewReduceUAAndroidVersionDeviceModel: Enables reduction of the user-agent
-            //    Android version and device model.
-            helper.applyFlagOverrides(
-                    Map.of(
-                            AwFeatures.WEBVIEW_REDUCE_UA_ANDROID_VERSION_DEVICE_MODEL,
-                            shouldEnableUserAgentReduction(),
-                            BlinkFeatures.REDUCE_USER_AGENT_MINOR_VERSION,
-                            shouldEnableUserAgentReduction()));
-
             setSingleton(this);
         }
 
